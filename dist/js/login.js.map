{"version":3,"sources":["webpack:///./src/js/login.js"],"names":["islogin","prototype","setCookie","c_name","value","expiredays","exdate","Date","setDate","getDate","document","cookie","escape","toGMTString","getCookie","name","arr","reg","RegExp","match","compiled","mounted","data","logining","username","password","lastUserName","computed","created","watch","val","methods","toLogin","vm","apiobj","url","public_key","tips","fnGet","then","publicKey","res","rsaKey","setPublic","modulus","exponent","enPwd","encrypt","doLogin","cid","localStorage","getItem","login","currentShiftId","enPasswd","tmpKey","loading","load","shade","fnPost","close","window","setItem","accessToken","pushLocal","location","href","msg","icon","alert","$mount"],"mappings":"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","file":"login.js","sourcesContent":["\r\nimport Vue from 'vue'\r\nimport layer from 'layer';\r\nimport {request, API_URLS} from 'util/request.js';\r\nimport util from 'util/util.js';\r\nimport {RSAKey,hex2b64,b64tohex} from 'util/rsa.js';\r\n\r\n\r\n\r\nVue.islogin=false;\r\n//设置cookie,增加到vue实例方便全局调用\r\n//vue全局调用的理由是，有些组件所用到的接口可能需要session验证，session从cookie获取\r\n//当然，如果session保存到vuex的话除外\r\nVue.prototype.setCookie = (c_name, value, expiredays) => {\r\n    var exdate = new Date();\r\n    exdate.setDate(exdate.getDate() + expiredays);\r\n    document.cookie = c_name + \"=\" + escape(value) + ((expiredays == null) ? \"\" : \";expires=\" + exdate.toGMTString());\r\n}\r\n\r\n//获取cookie\r\nVue.prototype.getCookie = (name) => {\r\n    var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\r\n    if (arr = document.cookie.match(reg))\r\n        return (arr[2]);\r\n    else\r\n        return null;\r\n}\r\n\r\n\r\nnew Vue({\r\n        compiled:function(){\r\n\r\n        },\r\n        mounted: function() {\r\n\r\n\r\n        },\r\n        data: {\r\n            logining:false,\r\n            username: '',\r\n            password: '',\r\n            lastUserName:\"\"\r\n        },\r\n        computed:{\r\n\r\n        },\r\n        created(){\r\n\r\n          this.lastUserName=  this.getCookie(\"username\") ;\r\n          this.username=this.lastUserName;\r\n\r\n        },\r\n        watch: {\r\n            'username': function (val) {\r\n                if(this.logining){return;}\r\n                if(val){\r\n                   //实时action\r\n                }\r\n                else{\r\n                    //layer.tips('请输入用户名', '#username');\r\n                }\r\n            },\r\n            'password': function (val) {\r\n                if(val){\r\n                    //实时action\r\n                }\r\n                else{\r\n                    //layer.tips('请输入密码', '#password');\r\n                }\r\n            }\r\n        },\r\n        methods: {\r\n            toLogin:function(){\r\n                let vm=this;\r\n                let apiobj={\r\n                    url:API_URLS.public_key,\r\n                };\r\n\r\n                if(vm.logining){return false;}\r\n                if(!vm.username){ layer.tips('请输入用户名', '#username'); return false;}\r\n                if(!vm.password){ layer.tips('请输入密码', '#password'); return false;}\r\n\r\n                vm.logining=true;\r\n\r\n                request.fnGet(apiobj).then(res=>{\r\n\r\n                    let publicKey=res.data;\r\n                    let rsaKey = new RSAKey();\r\n                    rsaKey.setPublic(b64tohex(publicKey.modulus), b64tohex(publicKey.exponent));\r\n                    let enPwd = hex2b64(rsaKey.encrypt(vm.password));\r\n                    vm.password = enPwd;\r\n                    vm.doLogin(publicKey, vm.username, enPwd);\r\n\r\n                })\r\n            },\r\n            doLogin:function(publicKey, username, enPwd) {\r\n                if(publicKey && enPwd){\r\n                    let vm = this;\r\n                    let cid=localStorage.getItem(\"currentShiftId\");\r\n                    let apiobj = {\r\n                        url: API_URLS.login,\r\n                        data: {\r\n                            currentShiftId:cid,\r\n                            username: username,\r\n                            enPasswd: enPwd,\r\n                            tmpKey: publicKey.tmpKey\r\n                        }\r\n                    };\r\n\r\n                    let loading = layer.load(2, {\r\n                        shade: [0.1,'#fff'] //0.1透明度的白色背景\r\n                    });\r\n\r\n                    request.fnPost(vm, apiobj, function (res) {\r\n                        layer.close(loading);\r\n                        window.localStorage.setItem(\"accessToken\",res.accessToken);\r\n                        util.pushLocal('shopData',res);\r\n\r\n\r\n                       if(vm.lastUserName!=vm.username){\r\n                           util.pushLocal(\"pageList\", []);\r\n                       }\r\n\r\n                        vm.setCookie(\"username\",username,7);\r\n                        location.href=\"./index.html\";\r\n\r\n                    }, function (res) {\r\n                        layer.close(loading);\r\n                        layer.msg(res.msg, {icon: 2});\r\n                        vm.password=\"\";\r\n                        vm.logining=false;\r\n                    })\r\n\r\n                }else{\r\n                    alert('服务器链接失败');\r\n                }\r\n            }\r\n        }\r\n    }).$mount('#main');\n\n\n// WEBPACK FOOTER //\n// ./src/js/login.js"],"sourceRoot":""}